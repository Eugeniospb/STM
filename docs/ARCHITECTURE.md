# Фемида — Архитектура юридической системы v3.0

## 1. Принципы дизайна

### 1.1. Разделение ответственности

| Слой | Назначение |
|------|------------|
| **Prompt** | Роль, ограничения, формат ответа, философия риска |
| **Logic** | Маршрутизация, предохранители, эскалация, контроль качества |
| **RAG** | Факты/нормы/шаблоны, которые должны цитироваться |

> Если смешать — получишь "юриста-артиста", который иногда спасает, иногда топит.

### 1.2. Два контура

- **Внешний контур** (что отправляем): всегда защитно, процессуально, без самооговора
- **Внутренний контур** (что говорим директору): беспощадно честно о рисках

---

## 2. Текущая реализация (v3.0)

### Режимы
- `LITIGATION` — претензии, суд, споры
- `CONTRACT_REVIEW` — анализ договоров
- `COMPLIANCE` — госорганы, проверки
- `CORPORATE` — кадры, ЛНА, внутренние документы

### Компоненты
- `bot.py` — основной бот, оркестрация
- `legal_prompts.py` — 4 системных промпта + детектор + safety check
- `companies.py` — реквизиты юрлиц группы СТМ
- `rag_engine.py` — RAG с 215 статьями законодательства

### Safety Check
- Regex-фильтр опасных фраз
- Триггеры эскалации (>3 млн ₽, уголовка, банкротство)

---

## 3. Roadmap (что добавить)

### 3.1. Brain → Writer (двухпроходная схема)
```
Запрос → Brain (анализ) → Safety Check → Writer (чистовой текст)
```
Brain получает все факты, Writer получает только выводы + реквизиты + тон.

### 3.2. Разделение CONTRACT_REVIEW
- `CONTRACT_REVIEW_INBOUND` — договор от контрагента (ищем ловушки)
- `CONTRACT_REVIEW_OUTBOUND` — наш шаблон (проверяем защиту)

### 3.3. Case Memory
Структурное хранение:
- стороны (ООО/ИП)
- договор/номер/дата
- суммы
- статус спора
- отправленные письма (версии)
- позиция Brain (последняя)
- риск-оценка

### 3.4. Контекстный Safety Check
```
regex → LLM-верификация → автопереписывание
```

### 3.5. Approved Clauses / Playbook
Для договоров:
- приёмка: "молчаливое принятие" / сроки на замечания
- лимит ответственности
- штрафы с потолком
- этапность/аванс
- изменения ТЗ только допсоглашением

---

## 4. RAG-хранилище (план)

### Текущее
- 215 статей: ГК РФ, ТК РФ, НК РФ
- paraphrase-multilingual-MiniLM-L12-v2

### Добавить
- Шаблоны STM (golden templates)
- Approved clauses
- Few-shot эталоны по режимам
- Чек-листы по инспекциям (ФНС/ГИТ)

---

## 5. Метрики (план)

- Доля ответов, прошедших safety без переписывания
- Доля эскалаций
- Среднее время цикла "анализ → чистовой"
- Частые причины "нехватка данных"

---

## 6. Юрлица группы СТМ

| Юрлицо | ИНН | Роль |
|--------|-----|------|
| ООО «СТМ» | 7813568956 | Основное |
| ИП Тихонов А.В. | 781428127765 | Производство/мебель |
| ИП Трифонов А.В. | 583700333358 | Операционный |

---

## 7. Файловая структура
```
/opt/stm-femida-bot/
├── bot.py              # Основной бот
├── legal_prompts.py    # 4 режима + детектор + safety
├── companies.py        # Реквизиты юрлиц
├── rag_engine.py       # RAG-движок
├── templates/          # DOCX-бланки
│   ├── blank_ooo_stm.docx
│   ├── blank_ip_tikhonov.docx
│   └── blank_ip_trifonov.docx
├── docs/
│   └── ARCHITECTURE.md # Этот документ
└── .env                # Токены
```

---

*Обновлено: январь 2026*
